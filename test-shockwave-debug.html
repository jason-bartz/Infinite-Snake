<!DOCTYPE html>
<html>
<head>
    <title>Shockwave Debug Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: monospace;
        }
        #log {
            white-space: pre-wrap;
            border: 1px solid #444;
            padding: 10px;
            height: 600px;
            overflow-y: auto;
        }
        button {
            margin: 10px 5px;
            padding: 10px;
            background: #333;
            color: #fff;
            border: 1px solid #666;
            cursor: pointer;
        }
        button:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <h1>Shockwave Debug Test</h1>
    <div>
        <button onclick="testPlayerShockwave()">Test Player Shockwave</button>
        <button onclick="testAIShockwave()">Test AI Shockwave</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    <div id="log"></div>

    <script>
        const logDiv = document.getElementById('log');

        function log(message) {
            const timestamp = new Date().toISOString().substr(11, 12);
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            logDiv.textContent = '';
        }

        // Mock objects for testing
        let shockwaves = [];
        let playerSnake = null;
        let currentBoss = null;

        class MockSnake {
            constructor(isPlayer, name) {
                this.isPlayer = isPlayer;
                this.name = name;
                this.segments = [{x: 100, y: 100}];
                this.elements = [1, 2]; // Mock elements
                this.alive = true;
            }

            checkCombinations() {
                log(`${this.name} checking combinations...`);
                
                // Mock combination found
                const chosen = {
                    elem1: 1,
                    elem2: 2,
                    result: 3
                };

                log(`${this.name} found combination: ${chosen.elem1} + ${chosen.elem2} = ${chosen.result}`);

                // This is the critical check from the game code
                if (this.isPlayer && this === playerSnake && currentBoss && currentBoss.alive) {
                    const bossElementId = currentBoss.elementId;
                    log(`${this.name} checking boss element match. Boss element: ${bossElementId}`);
                    
                    if (chosen.elem1 === bossElementId || chosen.elem2 === bossElementId || chosen.result === bossElementId) {
                        log(`${this.name} CREATING SHOCKWAVE! isPlayer: ${this.isPlayer}, playerSnake match: ${this === playerSnake}`);
                        shockwaves.push({
                            x: this.segments[0].x,
                            y: this.segments[0].y,
                            source: this.name
                        });
                    } else {
                        log(`${this.name} no boss element match`);
                    }
                } else {
                    log(`${this.name} shockwave check failed - isPlayer: ${this.isPlayer}, is playerSnake: ${this === playerSnake}, boss alive: ${currentBoss?.alive}`);
                }
            }
        }

        class MockBoss {
            constructor() {
                this.alive = true;
                this.elementId = 1; // Fire element
            }
        }

        function testPlayerShockwave() {
            log('=== Testing Player Shockwave ===');
            shockwaves = [];
            
            // Create boss
            currentBoss = new MockBoss();
            log(`Created boss with element ID: ${currentBoss.elementId}`);
            
            // Create player snake
            playerSnake = new MockSnake(true, 'Player');
            log(`Created player snake - isPlayer: ${playerSnake.isPlayer}`);
            
            // Test combination
            playerSnake.checkCombinations();
            
            log(`Shockwaves created: ${shockwaves.length}`);
            shockwaves.forEach(sw => log(`  Shockwave from: ${sw.source}`));
        }

        function testAIShockwave() {
            log('\n=== Testing AI Shockwave ===');
            shockwaves = [];
            
            // Ensure boss and player exist
            if (!currentBoss) {
                currentBoss = new MockBoss();
                log(`Created boss with element ID: ${currentBoss.elementId}`);
            }
            if (!playerSnake) {
                playerSnake = new MockSnake(true, 'Player');
                log(`Created player snake reference`);
            }
            
            // Create AI snake
            const aiSnake = new MockSnake(false, 'AI Snake');
            log(`Created AI snake - isPlayer: ${aiSnake.isPlayer}`);
            
            // Test combination
            aiSnake.checkCombinations();
            
            log(`Shockwaves created: ${shockwaves.length}`);
            shockwaves.forEach(sw => log(`  Shockwave from: ${sw.source}`));
        }

        // Initial log
        log('Shockwave Debug Test Ready');
        log('Click buttons to test shockwave creation');
    </script>
</body>
</html>