<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Search Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Admin Panel Search Pagination Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Main Search (20+ results)</h2>
        <button onclick="testMainSearch()">Run Test</button>
        <div id="mainSearchStatus"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Recipe Search (50+ results)</h2>
        <button onclick="testRecipeSearch()">Run Test</button>
        <div id="recipeSearchStatus"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Create Recipe Search (50+ results)</h2>
        <button onclick="testCreateSearch()">Run Test</button>
        <div id="createSearchStatus"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 4: Load More Functionality</h2>
        <button onclick="testLoadMore()">Run Test</button>
        <div id="loadMoreStatus"></div>
    </div>

    <script>
        async function testMainSearch() {
            const status = document.getElementById('mainSearchStatus');
            status.innerHTML = '<div class="status info">Loading elements data...</div>';
            
            try {
                // Load elements
                const response = await fetch('/elements/data/elements.json');
                const elements = await response.json();
                
                // Filter for common search term
                const searchTerm = 'a';
                const matches = elements.filter(elem => 
                    elem.n.toLowerCase().includes(searchTerm)
                );
                
                status.innerHTML = `
                    <div class="status success">✓ Found ${matches.length} elements containing "${searchTerm}"</div>
                    <div class="status ${matches.length > 20 ? 'success' : 'error'}">
                        ${matches.length > 20 ? '✓' : '✗'} More than 20 results (pagination needed): ${matches.length > 20 ? 'YES' : 'NO'}
                    </div>
                    <pre>First 5 matches: ${JSON.stringify(matches.slice(0, 5).map(e => e.n), null, 2)}</pre>
                `;
                
                // Test batch size
                const BATCH_SIZE = 20;
                const batches = Math.ceil(matches.length / BATCH_SIZE);
                status.innerHTML += `
                    <div class="status info">With batch size ${BATCH_SIZE}, this would require ${batches} pages</div>
                `;
                
            } catch (error) {
                status.innerHTML = `<div class="status error">Error: ${error.message}</div>`;
            }
        }
        
        async function testRecipeSearch() {
            const status = document.getElementById('recipeSearchStatus');
            status.innerHTML = '<div class="status info">Testing recipe search...</div>';
            
            try {
                // Simulate recipe search
                const response = await fetch('/elements/data/elements.json');
                const elements = await response.json();
                
                // Common search that would return many results
                const searchTerm = 'e';
                const matches = elements.filter(elem => 
                    elem.n.toLowerCase().includes(searchTerm) || 
                    elem.i.toString().includes(searchTerm)
                );
                
                status.innerHTML = `
                    <div class="status success">✓ Found ${matches.length} elements for recipe search</div>
                    <div class="status ${matches.length > 50 ? 'success' : 'error'}">
                        ${matches.length > 50 ? '✓' : '✗'} More than 50 results (pagination needed): ${matches.length > 50 ? 'YES' : 'NO'}
                    </div>
                `;
                
                const BATCH_SIZE = 50;
                const batches = Math.ceil(matches.length / BATCH_SIZE);
                status.innerHTML += `
                    <div class="status info">With batch size ${BATCH_SIZE}, this would require ${batches} pages</div>
                `;
                
            } catch (error) {
                status.innerHTML = `<div class="status error">Error: ${error.message}</div>`;
            }
        }
        
        async function testCreateSearch() {
            const status = document.getElementById('createSearchStatus');
            status.innerHTML = '<div class="status info">Testing create recipe search...</div>';
            
            try {
                const response = await fetch('/elements/data/elements.json');
                const elements = await response.json();
                
                // Test search that includes create option
                const searchTerm = 'dragon';
                const matches = elements.filter(elem => 
                    elem.n.toLowerCase().includes(searchTerm)
                );
                
                const hasExactMatch = elements.some(elem => 
                    elem.n.toLowerCase() === searchTerm
                );
                
                status.innerHTML = `
                    <div class="status success">✓ Search for "${searchTerm}" found ${matches.length} matches</div>
                    <div class="status ${!hasExactMatch ? 'success' : 'info'}">
                        ${!hasExactMatch ? '✓ "Create new" option would appear' : 'ℹ Exact match exists, no create option'}
                    </div>
                `;
                
                // Test with many results
                const commonSearch = 'r';
                const manyMatches = elements.filter(elem => 
                    elem.n.toLowerCase().includes(commonSearch)
                );
                
                status.innerHTML += `
                    <div class="status info">Search for "${commonSearch}" returns ${manyMatches.length} results</div>
                    <div class="status ${manyMatches.length > 50 ? 'success' : 'info'}">
                        ${manyMatches.length > 50 ? '✓' : 'ℹ'} Pagination ${manyMatches.length > 50 ? 'required' : 'not required'}
                    </div>
                `;
                
            } catch (error) {
                status.innerHTML = `<div class="status error">Error: ${error.message}</div>`;
            }
        }
        
        async function testLoadMore() {
            const status = document.getElementById('loadMoreStatus');
            status.innerHTML = '<div class="status info">Testing load more functionality...</div>';
            
            try {
                // Simulate pagination
                const response = await fetch('/elements/data/elements.json');
                const allElements = await response.json();
                
                // Test pagination logic
                let currentDisplayed = 0;
                const BATCH_SIZE = 20;
                const totalElements = allElements.length;
                
                let html = '<div class="status success">✓ Pagination simulation:</div>';
                let page = 1;
                
                while (currentDisplayed < totalElements) {
                    const nextBatch = Math.min(BATCH_SIZE, totalElements - currentDisplayed);
                    currentDisplayed += nextBatch;
                    
                    html += `<div class="status info">Page ${page}: Showing ${nextBatch} items (${currentDisplayed}/${totalElements} total)</div>`;
                    
                    if (currentDisplayed < totalElements) {
                        html += `<div class="status info">→ "Load More" button would show: ${totalElements - currentDisplayed} remaining</div>`;
                    } else {
                        html += `<div class="status success">✓ All items loaded, "Load More" button hidden</div>`;
                    }
                    
                    page++;
                    if (page > 5) { // Limit output for readability
                        html += `<div class="status info">... (${Math.ceil((totalElements - currentDisplayed) / BATCH_SIZE)} more pages)</div>`;
                        break;
                    }
                }
                
                status.innerHTML = html;
                
            } catch (error) {
                status.innerHTML = `<div class="status error">Error: ${error.message}</div>`;
            }
        }
        
        // Run all tests on load
        window.addEventListener('load', () => {
            console.log('Admin search pagination test page loaded');
        });
    </script>
</body>
</html>