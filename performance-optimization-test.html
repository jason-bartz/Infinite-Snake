<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Optimization Test - Infinite Snake</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: #fff;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #0f0;
            text-align: center;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .status-card {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
        }
        .status-card h3 {
            color: #00ff00;
            margin-top: 0;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #222;
        }
        .status-value {
            font-weight: bold;
        }
        .status-value.active {
            color: #0f0;
        }
        .status-value.inactive {
            color: #f00;
        }
        .status-value.warning {
            color: #ff0;
        }
        .performance-graph {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
            height: 200px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }
        .graph-line {
            position: absolute;
            bottom: 0;
            width: 2px;
            background: #0f0;
            transition: height 0.1s;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #444;
        }
        button.active {
            background: #0f0;
            color: #000;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th,
        .comparison-table td {
            padding: 10px;
            text-align: left;
            border: 1px solid #333;
        }
        .comparison-table th {
            background: #222;
            color: #0f0;
        }
        .improvement {
            color: #0f0;
        }
        .degradation {
            color: #f00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Infinite Snake - Performance Optimization Test</h1>
        
        <div class="controls">
            <button onclick="toggleOptimizations()">Toggle Optimizations</button>
            <button onclick="startPerformanceTest()">Run Performance Test</button>
            <button onclick="resetStats()">Reset Stats</button>
            <button onclick="openGame()">Open Game</button>
        </div>
        
        <div class="status-grid">
            <div class="status-card">
                <h3>üöÄ Optimization Systems</h3>
                <div class="status-item">
                    <span>Canvas Layer System</span>
                    <span class="status-value" id="canvasLayers">Checking...</span>
                </div>
                <div class="status-item">
                    <span>Gradient Cache</span>
                    <span class="status-value" id="gradientCache">Checking...</span>
                </div>
                <div class="status-item">
                    <span>State Optimizer</span>
                    <span class="status-value" id="stateOptimizer">Checking...</span>
                </div>
                <div class="status-item">
                    <span>Enhanced Batch Renderer</span>
                    <span class="status-value" id="enhancedBatch">Checking...</span>
                </div>
                <div class="status-item">
                    <span>Spatial Hashing</span>
                    <span class="status-value" id="spatialHash">Checking...</span>
                </div>
            </div>
            
            <div class="status-card">
                <h3>üìä Performance Metrics</h3>
                <div class="status-item">
                    <span>Current FPS</span>
                    <span class="status-value" id="currentFPS">--</span>
                </div>
                <div class="status-item">
                    <span>Average FPS</span>
                    <span class="status-value" id="avgFPS">--</span>
                </div>
                <div class="status-item">
                    <span>Frame Time (ms)</span>
                    <span class="status-value" id="frameTime">--</span>
                </div>
                <div class="status-item">
                    <span>Draw Calls/Frame</span>
                    <span class="status-value" id="drawCalls">--</span>
                </div>
                <div class="status-item">
                    <span>Canvas Operations</span>
                    <span class="status-value" id="canvasOps">--</span>
                </div>
            </div>
            
            <div class="status-card">
                <h3>üíæ Cache Statistics</h3>
                <div class="status-item">
                    <span>Gradient Cache Hit Rate</span>
                    <span class="status-value" id="gradientHitRate">--</span>
                </div>
                <div class="status-item">
                    <span>Emoji Cache Size</span>
                    <span class="status-value" id="emojiCacheSize">--</span>
                </div>
                <div class="status-item">
                    <span>Batch Efficiency</span>
                    <span class="status-value" id="batchEfficiency">--</span>
                </div>
                <div class="status-item">
                    <span>Culled Objects</span>
                    <span class="status-value" id="culledObjects">--</span>
                </div>
                <div class="status-item">
                    <span>State Changes Saved</span>
                    <span class="status-value" id="stateChangesSaved">--</span>
                </div>
            </div>
            
            <div class="status-card">
                <h3>üåê Browser Information</h3>
                <div class="status-item">
                    <span>Browser</span>
                    <span class="status-value" id="browserInfo">--</span>
                </div>
                <div class="status-item">
                    <span>Safari Detected</span>
                    <span class="status-value" id="safariDetected">--</span>
                </div>
                <div class="status-item">
                    <span>Mobile Device</span>
                    <span class="status-value" id="mobileDevice">--</span>
                </div>
                <div class="status-item">
                    <span>Hardware Concurrency</span>
                    <span class="status-value" id="hardwareCores">--</span>
                </div>
                <div class="status-item">
                    <span>Device Memory</span>
                    <span class="status-value" id="deviceMemory">--</span>
                </div>
            </div>
        </div>
        
        <div class="status-card">
            <h3>üìà FPS Graph (Real-time)</h3>
            <div class="performance-graph" id="fpsGraph"></div>
        </div>
        
        <div class="status-card">
            <h3>‚ö° Performance Comparison</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Without Optimizations</th>
                        <th>With Optimizations</th>
                        <th>Improvement</th>
                    </tr>
                </thead>
                <tbody id="comparisonTable">
                    <tr>
                        <td>Average FPS</td>
                        <td id="fps-without">--</td>
                        <td id="fps-with">--</td>
                        <td id="fps-improvement">--</td>
                    </tr>
                    <tr>
                        <td>Draw Calls</td>
                        <td id="draws-without">--</td>
                        <td id="draws-with">--</td>
                        <td id="draws-improvement">--</td>
                    </tr>
                    <tr>
                        <td>Frame Time (ms)</td>
                        <td id="frametime-without">--</td>
                        <td id="frametime-with">--</td>
                        <td id="frametime-improvement">--</td>
                    </tr>
                    <tr>
                        <td>Memory Usage (MB)</td>
                        <td id="memory-without">--</td>
                        <td id="memory-with">--</td>
                        <td id="memory-improvement">--</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // Check for optimization systems
        function checkOptimizationSystems() {
            // Check each system
            const systems = {
                canvasLayers: window.CanvasLayerSystem,
                gradientCache: window.GradientCache,
                stateOptimizer: window.CanvasStateOptimizer,
                enhancedBatch: window.EnhancedBatchRenderer,
                spatialHash: window.SpatialHashGrid
            };
            
            for (const [id, system] of Object.entries(systems)) {
                const element = document.getElementById(id);
                if (system) {
                    element.textContent = 'Active';
                    element.className = 'status-value active';
                } else {
                    element.textContent = 'Not Loaded';
                    element.className = 'status-value inactive';
                }
            }
        }
        
        // Check browser information
        function checkBrowserInfo() {
            const ua = navigator.userAgent;
            const isSafari = /^((?!chrome|android).)*safari/i.test(ua);
            const isMobile = /Android|iPhone|iPad|iPod/i.test(ua);
            
            document.getElementById('browserInfo').textContent = getBrowserName();
            document.getElementById('safariDetected').textContent = isSafari ? 'Yes' : 'No';
            document.getElementById('safariDetected').className = 'status-value ' + (isSafari ? 'warning' : 'active');
            document.getElementById('mobileDevice').textContent = isMobile ? 'Yes' : 'No';
            document.getElementById('hardwareCores').textContent = navigator.hardwareConcurrency || 'Unknown';
            document.getElementById('deviceMemory').textContent = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Unknown';
        }
        
        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.indexOf("Chrome") > -1) return "Chrome";
            if (ua.indexOf("Safari") > -1) return "Safari";
            if (ua.indexOf("Firefox") > -1) return "Firefox";
            if (ua.indexOf("Edge") > -1) return "Edge";
            return "Unknown";
        }
        
        // FPS monitoring
        let fpsHistory = [];
        let frameCount = 0;
        let lastTime = performance.now();
        let lastFpsUpdate = 0;
        
        function updateFPS() {
            frameCount++;
            const now = performance.now();
            
            if (now - lastFpsUpdate > 1000) {
                const fps = Math.round(frameCount * 1000 / (now - lastFpsUpdate));
                document.getElementById('currentFPS').textContent = fps;
                
                // Update graph
                fpsHistory.push(fps);
                if (fpsHistory.length > 60) fpsHistory.shift();
                updateFPSGraph();
                
                frameCount = 0;
                lastFpsUpdate = now;
            }
            
            const frameTime = now - lastTime;
            document.getElementById('frameTime').textContent = frameTime.toFixed(2);
            lastTime = now;
            
            requestAnimationFrame(updateFPS);
        }
        
        function updateFPSGraph() {
            const graph = document.getElementById('fpsGraph');
            graph.innerHTML = '';
            
            fpsHistory.forEach((fps, index) => {
                const line = document.createElement('div');
                line.className = 'graph-line';
                line.style.left = `${index * 3}px`;
                line.style.height = `${Math.min(fps * 2, 200)}px`;
                line.style.background = fps >= 55 ? '#0f0' : fps >= 30 ? '#ff0' : '#f00';
                graph.appendChild(line);
            });
        }
        
        function openGame() {
            window.open('index.html', '_blank');
        }
        
        function toggleOptimizations() {
            // This would toggle optimizations in the game
            alert('Open the game and add ?optimizations=off to the URL to disable optimizations');
        }
        
        function startPerformanceTest() {
            alert('Performance test will run in the game window. Please open the game first.');
        }
        
        function resetStats() {
            fpsHistory = [];
            frameCount = 0;
            updateFPSGraph();
        }
        
        // Initialize on load
        window.addEventListener('load', () => {
            checkOptimizationSystems();
            checkBrowserInfo();
            updateFPS();
        });
        
        // Periodically check for loaded systems
        setInterval(checkOptimizationSystems, 2000);
    </script>
</body>
</html>